@page "/featured-products"
@using Manero_Customer.Data.Models
@using Manero_Customer.Services
@inject ProductService productService

<div class="container">
    <div class="featuredprod">
        <h3>Featured Products</h3>
        <a href="/all-featured-products" class="view-all">view all</a>
        <div class="featuredContainer home-featured-container">
            @foreach (var item in products.Take(4))
            {
                <NavLink class="p-Card" href="@GenerateProductLink(item.Title)">
                    <_ShopProductCard id="@item.Id"
                                      ImageUrl="@item.ImageUrl"
                                      Title="@item.Title"
                                      Price="@item.Price"
                                      DiscountPrice="@item.DiscountPrice"
                                      Rating="@item.Rating"
                                      OnSale="@item.OnSale" />
                </NavLink>
            }
        </div>
    </div>
</div>

@code {
    List<ProductModel> products = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var filters = new Dictionary<string, string>
            {
                { "featuredProduct", "true" }
            };
            products = await productService.FilterProduct(filters);
        }
        catch (Exception ex)
        {
            
            Console.Error.WriteLine($"Fel vid hämtning av produktdata: {ex.Message}");
        }
    }

    private string GenerateProductLink(string productName)
    {
        return $"/product/{Uri.EscapeDataString(productName)}";
    }
}
