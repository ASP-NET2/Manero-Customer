@page "/product/{title}"
@using Manero_Customer.Services
@using Manero_Customer.Data.Models
@inject NavigationManager Navigation
@inject ProductDetailsService productDetailsService
@inject ILogger<ProductPage> Logger

<div class="container">
    <section class="ProductPage">
        <div class="product-container">
            @if (product != null)
            {
                <div class="image-container">
                    <img class="product-image" src="@product.ImageUrl" alt="produktbild" />
                </div>
                <div class="product-content">
                    <h3>@product.Title</h3>
                    <p>Författare: @product.Author</p>
                    <p>Format: @product.FormatName</p>
                    <p class="price">@product.Price kr</p>
                    <h5>Beskrivning</h5>
                    <p>@product.ShortDescription</p>
                    <p>@product.LongDescription</p>
                </div>
            }
            else
            {
                <p>Produkten kunde inte hittas.</p>
            }
        </div>
        @if (product != null)
        {
            <button class="btn-theme">+ LÄGG TILL I KUNDVAGNEN</button>
        }
    </section>
</div>

@code {
    [Parameter]
    public string? Title { get; set; }

    private ProductDetailsModel? product;

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(Title))
        {
            try
            {
                Logger.LogInformation("Loading product details for title: {Title}", Title);
                var products = await productDetailsService.MatchProductsByTitleAsync(Title);
                product = products.FirstOrDefault();
                Logger.LogInformation("Product loaded: {Product}", product?.Title);
            }
            catch (Exception ex)
            {
                Logger.LogError(ex, "Error loading product details for title: {Title}", Title);
                product = null;
            }
        }
    }
}